# 企业周报管理系统 - 项目结构分析

## 一、项目概览

| 项目名称 | 企业周报管理系统 |
|---------|-----------------|
| 技术架构 | 前后端分离（Vue3 + Spring Boot） |
| 后端端口 | 8080 |
| 前端开发端口 | 5173（Vite） |
| 数据库 | MySQL 8.0+ |
| 缓存 | Redis 7.0+（配置中） |

---

## 二、整体目录结构

```
weekly-report/
├── weekly-report-backend/     # 后端（Spring Boot）
├── weekly-report-frontend/    # 前端（Vue3 + Vite）
├── docs/                      # 文档（本分析等）
├── README.md
├── 技术选型.md
├── 测试用例.md
├── 静态页面.md
└── prototype.html             # 静态原型
```

---

## 三、后端结构分析

### 3.1 技术栈

| 类别 | 技术 | 版本/说明 |
|------|------|-----------|
| 框架 | Spring Boot | 2.7.18 |
| ORM | MyBatis-Plus | 3.5.3 |
| 认证 | JWT | 无状态 |
| 文档 | Knife4j | 3.0.3（Swagger 增强） |
| 工具 | Lombok | 简化实体/DTO |

### 3.2 包结构（com.company.weeklyreport）

| 包名 | 职责 | 主要文件 |
|------|------|----------|
| **controller** | 接收请求、参数校验、返回统一结果 | AuthController, UserController, RoleController, DepartmentController, WeeklyReportController, StatisticsController |
| **service** | 业务逻辑、事务边界 | UserService, RoleService, DepartmentService, WeeklyReportService |
| **mapper** | 数据访问（MyBatis-Plus + 自定义 XML/SQL） | UserMapper, RoleMapper, DepartmentMapper, WeeklyReportMapper |
| **entity** | 与数据库表对应的实体 | User, Role, Department, WeeklyReport |
| **config** | 全局配置 | WebConfig（CORS、拦截器、编码）, JwtAuthInterceptor, MyBatisPlusConfig |
| **common** | 通用响应封装 | Result\<T\>（code/message/data） |
| **util** | 工具类 | JwtUtils |
| 根目录 | 启动类 | WeeklyReportApplication |

### 3.3 接口与职责

| 控制器 | 路径前缀 | 主要接口 | 说明 |
|--------|----------|----------|------|
| AuthController | /auth | POST /login, GET /info, POST /logout | 登录、当前用户信息、登出 |
| UserController | /user | GET /page, GET /:id, POST, PUT, DELETE /:id | 用户分页、详情、增删改 |
| RoleController | /role | GET /list, GET /:id, POST, PUT /:id/permissions, DELETE /:id | 角色列表、详情、增删改、权限更新 |
| DepartmentController | /department | GET /tree, POST, DELETE /:id | 部门树、新增、删除 |
| WeeklyReportController | /report | GET /current-week, /my-list, /current, /import-last-week, POST /draft, /submit, GET /team, /:id, POST /:id/review | 周次、我的周报、当前周报、导入上周、草稿、提交、团队周报、详情、评分 |
| StatisticsController | /statistics | GET /submit-rate, /score-trend | 提交率、评分趋势 |

### 3.4 资源与配置

| 路径 | 说明 |
|------|------|
| src/main/resources/application.yml | 服务端口、数据源、MyBatis-Plus、JWT、Knife4j、日志 |
| src/main/resources/db/schema.sql | 建库建表及初始数据 |
| src/main/resources/mapper/*.xml | MyBatis XML（如 WeeklyReportMapper、UserMapper） |

---

## 四、前端结构分析

### 4.1 技术栈

| 类别 | 技术 | 说明 |
|------|------|------|
| 框架 | Vue 3 | Composition API（\<script setup\>） |
| 构建 | Vite | 4.x |
| UI | Element Plus | 2.3.x，中文 locale |
| 路由 | Vue Router | 4.x，history 模式 |
| 状态 | Pinia | 用户登录态（token、userInfo） |
| HTTP | Axios | 封装 baseURL、拦截器、silent 可选静默失败 |
| 图表 | ECharts | 统计分析页 |
| 富文本 | @wangeditor/editor-for-vue | 写周报 |

### 4.2 目录与职责

| 目录/文件 | 职责 |
|-----------|------|
| **src/main.js** | 创建 Vue 应用，挂载 Pinia、Router、Element Plus、全局图标 |
| **src/App.vue** | 根组件，仅 \<router-view\> |
| **src/router/index.js** | 路由表、路由守卫（未登录跳转登录、标题） |
| **src/stores/user.js** | 用户状态：token、userInfo、login、logout、fetchUserInfo |
| **src/api/index.js** | Axios 实例、请求/响应拦截器、所有后端 API 封装 |
| **src/utils/date.js** | formatDateTime、formatDate、formatRelativeTime |
| **src/styles/index.scss** | 全局样式、滚动条、.card、.page-header、.search-bar |
| **src/views/** | 页面级组件（见下表） |

### 4.3 页面与路由

| 路由 | 组件 | 说明 |
|------|------|------|
| /login | Login.vue | 登录页（独立，无 Layout） |
| / | Layout.vue | 布局壳（侧栏 + 顶栏 + router-view） |
| /dashboard | Dashboard.vue | 工作台：统计卡片、历史周报、待办、周报详情弹窗 |
| /write-report | WriteReport.vue | 写周报：周次选择、富文本、暂存/提交、导入上周计划 |
| /team-report | TeamReport.vue | 团队周报：部门树、筛选、分页表格、详情与评分弹窗 |
| /analytics | Analytics.vue | 统计分析：提交率饼图、评分趋势折线图 |
| /user-management | UserManagement.vue | 用户管理：搜索、部门/角色筛选、表格、新增/编辑弹窗 |
| /role-management | RoleManagement.vue | 角色管理：表格、新增/编辑、权限配置弹窗 |
| /messages | Messages.vue | 消息中心：Tab、消息列表（当前为前端模拟数据） |
| /profile | Profile.vue | 个人中心：基本信息、修改密码、我的周报、通知设置 |

### 4.4 前端与后端对应关系

- 所有接口通过 **axios baseURL: '/api'** 访问，由 Vite 代理到 `http://localhost:8080`，路径重写为去掉 `/api`。
- 登录后请求头携带 `Authorization: Bearer \<token\>`；后端通过 JwtAuthInterceptor 解析（当前实现为放行所有请求，可按需恢复校验）。

---

## 五、数据流与权限

1. **登录**：前端调用 POST /auth/login，拿到 token 与 user 写入 Pinia 与 localStorage；路由守卫根据 token 判断是否放行需登录页面。
2. **请求**：除 /auth/login 外，请求均带 token；401 时拦截器清 token 并跳转登录。
3. **权限**：角色表存 permissions（JSON），前端可按角色控制菜单或按钮；后端可按需在拦截器或 Controller 中按权限校验。

---

## 六、部署与运行依赖

- **后端**：JDK 8+、Maven 3.8+、MySQL 8.0+、Redis（若启用）。
- **前端**：Node.js 14+、npm 或 pnpm；生产构建为静态资源，可部署至 Nginx 等，API 需反向代理到后端。

---

*文档生成依据当前仓库代码与 schema.sql，如有结构变更请同步更新本文档。*
