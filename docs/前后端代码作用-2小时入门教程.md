# 前后端代码作用 —— 2～3 小时入门教程

> 目标：在 2～3 小时内理解本项目中**前端代码**和**后端代码**各自负责什么，以及它们如何配合。适合完成 mentor 布置的「前后端代码有什么作用」任务。

---

## 一、5 分钟：前后端各负责什么（总览）

| 角色 | 运行环境 | 主要职责 | 在本项目中的位置 |
|------|----------|----------|------------------|
| **前端** | 用户浏览器（如 Chrome） | 展示页面、收集用户操作、发 HTTP 请求、根据响应更新界面 | `weekly-report-frontend/` |
| **后端** | 服务器（本机 8080 端口） | 接收请求、查库/写库、业务逻辑、返回 JSON 数据 | `weekly-report-backend/` |

- **前端**：用户看到的登录页、工作台、表格、按钮等，以及「点登录」后发请求、收到数据后跳转。
- **后端**：不负责画页面，只提供**接口**（如 `POST /auth/login`）。收到请求后校验账号密码、查数据库、生成 token，再以 JSON 形式返回给前端。

**一句话**：前端负责「长什么样、用户点了什么」；后端负责「数据从哪来、存到哪、业务规则」。

---

## 二、30 分钟：前端代码结构与本项目中的作用

### 2.1 前端目录与职责（对应本仓库）

| 目录/文件 | 作用 |
|-----------|------|
| `src/main.js` | 创建 Vue 应用，挂载路由、Pinia、Element Plus，**前端入口** |
| `src/App.vue` | 根组件，里面主要是 `<router-view />`，用来**切换页面** |
| `src/router/index.js` | **路由**：URL 与页面的对应关系（如 `/login` → 登录页，`/dashboard` → 工作台），以及「未登录跳转登录」等守卫 |
| `src/stores/user.js` | **状态**：保存登录态（token、用户信息），提供 `login`、`logout`、`fetchUserInfo` 等方法 |
| `src/api/index.js` | **请求封装**：创建 axios 实例、统一加 token、把所有调用后端的接口封装成函数（如 `login`、`getUserPage`） |
| `src/views/*.vue` | **页面组件**：每个页面一个文件，如 `Login.vue`（登录）、`Dashboard.vue`（工作台）、`WriteReport.vue`（写周报） |
| `src/styles/index.scss` | 全局样式 |

### 2.2 前端在「登录」流程里具体做了什么

以**用户点击登录按钮**为例，前端代码的作用是：

1. **页面与表单**（`src/views/Login.vue`）  
   - 展示登录表单（邮箱、密码输入框、登录按钮）。  
   - 用户点击「登录」时调用 `handleLogin`，先做表单校验（如必填、邮箱格式）。

2. **调用登录接口**（`src/stores/user.js` + `src/api/index.js`）  
   - `userStore.login(email, password)` 内部会调用 `loginApi({ email, password })`。  
   - `loginApi` 在 `api/index.js` 里：`request.post('/auth/login', data)`，即向后端发 **POST /api/auth/login**（Vite 代理会把 `/api` 转到后端 8080）。

3. **处理响应**（`src/stores/user.js`）  
   - 若 `res.code === 200` 且 `res.data.token` 存在：把 `token` 和 `user` 存到 Pinia 和 `localStorage`，返回 `true`。  
   - 登录页根据返回值提示「登录成功」并跳转到 `/dashboard`（在 `Login.vue` 里 `router.push('/dashboard')`）。

4. **之后的请求都带 token**（`src/api/index.js`）  
   - 请求拦截器从 `localStorage` 取 `token`，设置 `Authorization: Bearer <token>`，这样后端就能识别是哪个用户。

**小结**：前端负责「界面 + 发请求 + 存 token + 根据结果跳转/提示」，不负责校验密码、查数据库。

---

## 三、30 分钟：后端代码结构与本项目中的作用

### 3.1 后端目录与职责（对应本仓库）

| 包/目录 | 作用 |
|---------|------|
| `controller/` | **接口层**：定义 URL、接收参数、调用 Service、返回统一格式 `Result<T>` |
| `service/` | **业务逻辑**：登录校验、分页查询、周报提交与审核等，可调用多个 Mapper |
| `mapper/` | **数据访问**：和数据库表打交道（MyBatis-Plus），如按邮箱查用户、插入周报 |
| `entity/` | **实体类**：和数据库表一一对应的 Java 类（如 `User`、`WeeklyReport`） |
| `config/` | **配置**：CORS、拦截器（如 JWT 解析）、MyBatis-Plus、Redis 等 |
| `common/Result.java` | 统一返回格式：`code`、`message`、`data` |
| `util/JwtUtils.java` | 生成/解析 JWT token，用于无状态认证 |

### 3.2 后端在「登录」流程里具体做了什么

以 **POST /auth/login** 为例，后端代码的作用是：

1. **接收请求**（`AuthController.java`）  
   - `@PostMapping("/login")` 接收请求体中的 `email`、`password`（对应前端的 `LoginDTO`）。  
   - 调用 `userService.login(dto.getEmail(), dto.getPassword())`。

2. **业务逻辑**（`UserService.java`）  
   - 用 `UserMapper` 按邮箱查用户；若不存在则返回 `null`。  
   - 对前端传来的密码做 MD5 加密，与库中密码比对；不一致则返回 `null`。  
   - 检查用户状态（如 `status == 1` 才允许登录）。  
   - 通过则返回 `User` 对象。

3. **生成 token 并返回**（`AuthController.java`）  
   - 用 `JwtUtils.generateToken(userId, username)` 生成 JWT。  
   - 封装成 `Result.success(data)`，其中 `data` 包含 `token` 和 `user`，前端拿到的就是这份 JSON。

**小结**：后端负责「校验账号密码、查库、生成 token、返回 JSON」，不负责画登录页、不直接操作浏览器。

---

## 四、45 分钟：一条完整请求链路（登录）—— 前后端如何配合

建议按下面顺序在项目里打开对应文件，对照看一遍，加深「谁在什么时候做什么」的印象。

### 步骤 1：前端发起请求（约 10 分钟）

1. 打开 `weekly-report-frontend/src/views/Login.vue`。  
   - 找到 `handleLogin`：校验表单 → 调用 `userStore.login(form.email, form.password)`。
2. 打开 `weekly-report-frontend/src/stores/user.js`。  
   - 找到 `login`：内部调用 `loginApi({ email, password })`。
3. 打开 `weekly-report-frontend/src/api/index.js`。  
   - 找到 `login`：`request.post('/auth/login', data)`，即 **POST /api/auth/login**；  
   - 看请求拦截器：如何把 `localStorage` 里的 token 放到请求头（登录时还没有 token，其他接口会带）。

### 步骤 2：后端处理请求（约 15 分钟）

1. 打开 `weekly-report-backend/.../controller/AuthController.java`。  
   - 看 `login` 方法：接收 `LoginDTO`，调 `userService.login`，用 `JwtUtils` 生成 token，返回 `Result.success(data)`。
2. 打开 `weekly-report-backend/.../service/UserService.java`。  
   - 看 `login` 方法：`baseMapper.selectByEmail(email)` 查用户，MD5 比对密码，检查状态，返回 `User` 或 `null`。
3. 打开 `weekly-report-backend/.../mapper/UserMapper.java`（以及若有的 XML）。  
   - 理解：Mapper 负责执行 SQL，这里就是「按 email 查一条用户记录」。

### 步骤 3：响应回到前端（约 10 分钟）

1. 再看 `AuthController` 的返回：`Result.success(data)` 会变成 JSON，形如：  
   `{ "code": 200, "message": "success", "data": { "token": "xxx", "user": { ... } } }`。
2. 回到 `weekly-report-frontend/src/stores/user.js` 的 `login`：  
   - 收到 `res` 后判断 `res.code === 200 && res.data.token`，存 token 和 user 到 Pinia 与 localStorage。
3. 回到 `Login.vue` 的 `handleLogin`：  
   - `userStore.login` 返回 `true` 后，`router.push('/dashboard')` 跳转工作台。

### 步骤 4：再选一条「需登录」的接口（约 10 分钟）

例如 **GET /auth/info**（获取当前用户信息）：

- 前端：`getUserInfo()` → `request.get('/auth/info')`，请求拦截器会自动带上 `Authorization: Bearer <token>`。  
- 后端：`AuthController.info()` 从 request 里取 `userId`（由 JWT 拦截器解析 token 后放入），再调 `userService.getUserWithInfo(userId)` 查库并返回用户信息。

这样你就串起了：**前端页面 → API 封装 → 后端 Controller → Service → Mapper → 数据库 → 再回到前端**。

---

## 五、30 分钟：整理成「我的理解」便于汇报

建议用下面三个问题做一份简短笔记（可直接用于向 mentor 汇报）：

1. **前端代码在本项目里主要做什么？**  
   - 答：负责页面展示（Vue 组件）、路由与权限控制、调用后端接口（axios/api）、保存登录态（Pinia + localStorage），并根据接口返回结果更新界面或跳转。

2. **后端代码在本项目里主要做什么？**  
   - 答：提供 REST 接口（Controller），实现业务逻辑（Service），通过 Mapper 访问 MySQL，做认证（JWT）、权限与数据校验，以统一格式（Result）返回 JSON 给前端。

3. **前后端如何配合？**  
   - 答：前端通过 HTTP（如 POST /auth/login、GET /report/team）把参数发给后端；后端处理完后返回 JSON；前端根据 code/data 更新页面或提示。登录后前端在请求头带 token，后端通过 JWT 识别用户。

可以在笔记里补充 1～2 个你跟踪过的接口（如登录、获取团队周报），写出「前端哪个文件发请求 → 后端哪个 Controller/Service 处理」，会更有说服力。

---

## 六、建议学习顺序与时间分配（合计约 2～2.5 小时）

| 阶段 | 内容 | 建议时间 |
|------|------|----------|
| 1 | 读本文「一、总览」+ 项目根目录 `README.md` | 约 10 分钟 |
| 2 | 读「二、前端」+ 浏览 `frontend/src` 下 router、stores、api、views 各一个文件 | 约 25 分钟 |
| 3 | 读「三、后端」+ 浏览 `backend` 下 controller、service、mapper 各一个（如 Auth、User） | 约 25 分钟 |
| 4 | 按「四、一条完整请求链路」把登录流程在代码里走一遍 | 约 45 分钟 |
| 5 | 按「五、整理成我的理解」写几条笔记或口头复述 | 约 25 分钟 |

若时间更紧，可压缩：重点做「一 + 四（只做登录这一条链路）+ 五」。

---

## 七、延伸阅读（本项目内）

- **整体结构**：`docs/项目结构分析.md`（前后端包结构、接口列表、数据流与权限）。  
- **从零跑通**：`docs/小白入门-从零跑通.md`（环境与启动步骤）。  
- **API 文档**：后端启动后访问 http://localhost:8080/doc.html 查看 Knife4j 文档，可对照「前端调哪个 URL、后端哪个 Controller」加深印象。

---

*本教程围绕「前后端代码各有什么作用」设计，完成上述步骤即可在 2～3 小时内建立清晰概念并用于汇报。*
